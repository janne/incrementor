<html>
  <script type="text/javascript">
    function regexp() {
      return localStorage["regexp"] ? (new RegExp(localStorage["regexp"])) : /\d+(?!.*\d+)/;
    }

    function step() {
      return localStorage["step"] ? parseInt(localStorage["step"]) : 1;
    }

    chrome.tabs.onUpdated.addListener(function(tabId, changeInfo) {
      if (changeInfo.url) {
        if (changeInfo.url.match(regexp()))
          chrome.pageAction.show(tabId);
        else
          chrome.pageAction.hide(tabId);
      }
    });

    chrome.tabs.onSelectionChanged.addListener(function(tabId) {
      chrome.tabs.get(tabId, function(tab) {
        if (tab.url.match(regexp()))
          chrome.pageAction.show(tabId);
        else
          chrome.pageAction.hide(tabId);
      });
    });

    chrome.pageAction.onClicked.addListener(function(tab) {
      // Catch last number
      var number = tab.url.match(regexp()).toString();
      var replace = (parseInt(number,10) + step()).toString();

      // Handle zero padding
      if (number.match(/^0+/)) {
        var zeroes = number.match(/^0+/).toString().length + (parseInt(number,10).toString()).length - replace.length;
        for (var i=0; i<zeroes; i++) replace = "0" + replace;
      }

      chrome.tabs.update(tab.id, {url: tab.url.replace(regexp(), replace)});
    })
  </script>
</html>

